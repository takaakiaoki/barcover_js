<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<!-- for barcord generator -->
		<script src="//code.jquery.com/jquery-latest.min.js"></script>
		<script src="_3rdparty/Simple-jQuery-Based-Barcode-Generator-Barcode/jquery-barcode.js"></script>
	</head>
	<body>
		<title>Barcover JS</title>
		BarcoverをJavaScriptで作る?

		<h2>これまで</h2>
		<ol>
			<li> <a href="http://www.jqueryscript.net/other/Simple-jQuery-Based-Barcode-Generator-Barcode.html">Simple-JqueRy-Based-Barcode-Generator-Barcode</a> でバーコードを表示
			<li> インプットフィールドの変更に合わせバーコードを変更
		</ol>
		<h2>これから?</h2>
		<ol>
			<li>Canvas内にバーコードを配置
			<li>それ以外に必要な情報を配置
			<li> jsPDF で出力
		</ol>
		<!-- 入力に応じてバーコードがアップデートされるように -->
  	<form>
			<fieldset>
				<label for="student_id_form">学生証番号(10桁):</label>
				<input type="text" id="student_id_form" maxlength="10"> 
			</fieldset>
		</form>

		<script type="text/javascript">
			// http://qiita.com/maruyam-a/items/cf0168f91d934b449a07			
			// 冒頭10文字の変化のみをキャッチする.
			var old = $('#student_id_form').val();
			$("#student_id_barcode").barcode(
					"abcde",
					"code11");
			// old = v = v.substr(0, 10);
			$('#student_id_form').keyup(
					function(e) {
						var v = $('#student_id_form').val();
						if (old != v) {
							old = v;
							if ( jQuery.isNumeric(v) ){
								renderBarcode(v);
							} else {
								$("#student_id_barcode").html("");
							}
						}
					});

			// バーコードを描画する, 座標などを決めうち
			function renderBarcode(v) {
				var settings = {
					output: "canvas",
					fontsize: 12,
					barwidth: 1,
					posX: 10,
					posY: 10
				}
				clearCanvas();
				$("#canvasBC").barcode(
						v,
						"code11",
						settings);
			}

			// canvas初期化
			function clearCanvas() {
				var canvas = $('#canvasBC').get(0);
				var ctx = canvas.getContext('2d');
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				// draw frame
				ctx.lineWidth = 1;
				ctx.lineCap = 'butt';
				ctx.fillStyle = '#FFFFFF';
				ctx.strokeStyle = '#000000';
				ctx.strokeRect(0, 0, canvas.width, canvas.height);
			}

			// onload setup
			$(function() {
					clearCanvas();
				});
		</script>
		
		<!-- バーコード表示部 -->
		<!-- A4が 210mm x 297mm 
		     画面を 420 x 584 -->
		<canvas id="canvasBC", width="420", height="584"></canvas>
	</body>
</html>
<!-- references
Simple jQuery Based Barcode Generator - Barcode
	http://www.jqueryscript.net/other/Simple-jQuery-Based-Barcode-Generator-Barcode.html

javascriptでPDF出力(日本語表示)
	http://devlog.mitsugeek.net/entry/2014/08/21/javascript%E3%81%A7PDF%E5%87%BA%E5%8A%9B%EF%BC%88%E6%97%A5%E6%9C%AC%E8%AA%9E%E8%A1%A8%E7%A4%BA%EF%BC%89
-->
<!--
vim: ts=2 sw=2 fenc=utf8 fileformat=unix
-->
